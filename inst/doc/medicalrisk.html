<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Patrick McCormick patrick.mccormick@alum.mit.edu" />

<meta name="date" content="2016-01-23" />

<title>medicalrisk: Calculating risk and comorbidities from ICD-9-CM codes</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">medicalrisk: Calculating risk and comorbidities from ICD-9-CM codes</h1>
<h4 class="author"><em>Patrick McCormick <a href="mailto:patrick.mccormick@alum.mit.edu">patrick.mccormick@alum.mit.edu</a></em></h4>
<h4 class="date"><em>2016-01-23</em></h4>
</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The routines in the <strong>medicalrisk</strong> package <span class="citation">(McCormick and Joseph 2015)</span> are designed to help determine comorbidity and medical risk status of a given patient using several popular models published in the peer-reviewed literature.</p>
<p>Administrative healthcare data is frequently the only available source for determining individual risk of mortality when looking at thousands or millions of patient records. Medical chart abstraction just isn’t feasible for projects of this scale.</p>
<p>In the United States, the records for every inpatient and outpatient encounter is reviewed by a qualified medical coder who assigns a set of diagnosis and procedural codes based on phrases within the medical record. The coding system currently in use is <a href="http://en.wikipedia.org/wiki/ICD-9-CM">ICD-9-CM</a>. ICD-9-CM is an adaptation of the venerable ICD-9 standard which was developed in 1978. The <a href="http://www.cdc.gov/nchs/">U.S. National Center for Health Statistics (NCHS)</a> developed ICD-9-CM, which has been required for Medicare and Medicaid claims since 1979. ICD-9-CM is updated annually.</p>
<p>At some point, perhaps as soon as October 2015, <a href="http://www.cdc.gov/nchs/icd/icd10cm.htm">ICD-10-CM codes</a> will need to be used instead. It is likely that “dual coding” of claims in both sets will continue for some time.</p>
<p>In the meantime, there is a wealth of administrative data available within the ICD-9-CM diagnostic and procedural codes stored within US healthcare systems.</p>
</div>
<div id="working-with-icd-9-cm-data" class="section level2">
<h2>Working with ICD-9-CM Data</h2>
<p>In order to demonstrate this package, this package includes data on 100 patients from the <a href="http://healthvermont.gov/research/hospital-utilization/RECENT_PU_FILES.aspx">Vermont Uniform Hospital Discharge Data Set for 2011, Inpatient</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(medicalrisk)
<span class="kw">library</span>(plyr)
<span class="kw">data</span>(vt_inp_sample)
x &lt;-<span class="st"> </span><span class="kw">count</span>(vt_inp_sample, <span class="kw">c</span>(<span class="st">'id'</span>))
<span class="kw">cat</span>(<span class="st">&quot;average count of ICD codes per patient is: &quot;</span>, <span class="kw">mean</span>(x$freq))</code></pre>
<pre><code>## average count of ICD codes per patient is:  11.52</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">count</span>(vt_inp_sample, <span class="kw">c</span>(<span class="st">'icd9cm'</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitr)
<span class="kw">kable</span>(<span class="kw">head</span>(y[<span class="kw">order</span>(-y$freq),], <span class="dt">n=</span><span class="dv">5</span>), <span class="dt">row.names=</span>F,
      <span class="dt">caption=</span><span class="st">'Top 5 most popular ICD-9-CM codes in this dataset'</span>)</code></pre>
<table>
<caption>Top 5 most popular ICD-9-CM codes in this dataset</caption>
<thead>
<tr class="header">
<th align="left">icd9cm</th>
<th align="right">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">D4019</td>
<td align="right">34</td>
</tr>
<tr class="even">
<td align="left">D53081</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">D2724</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">D3051</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">D25000</td>
<td align="right">17</td>
</tr>
</tbody>
</table>
<p>Within this package, ICD-9-CM codes are presented as a string where the first letter is “P” or “D” depending on whether the code is Procedure or Diagnosis. The rest of the code is present as a string of numbers. Periods are omitted. In the list above, the code “D4019” is diagnostic code 401.9 which corresponds to Hypertension.</p>
</div>
<div id="comorbidity-maps" class="section level2">
<h2>Comorbidity Maps</h2>
<p>The package includes a set of mapping functions that transform a list of ICD-9-CM codes into a comorbidity matrix:</p>
<ul>
<li>icd9cm_charlson_deyo</li>
<li>icd9cm_charlson_romano</li>
<li>icd9cm_charlson_quan</li>
<li>icd9cm_elixhauser_ahrq37</li>
<li>icd9cm_elixhauser_quan</li>
<li>icd9cm_rcri</li>
</ul>
<p>“Charlson” refers to the Charlson Comorbidity Index<span class="citation">(Charlson et al. 1987)</span>.<br />The names “Deyo”<span class="citation">(Deyo, Cherkin, and Ciol 1992)</span>, “Romano”<span class="citation">(Romano, Roos, and Jollis 1993)</span>, and “Quan”<span class="citation">(Quan et al. 2005)</span> refer to the primary authors of different methods of determining Charlson comorbidities from ICD-9-CM codes.</p>
<p>“Elixhauser” refers to the Elixhauser comorbidity map, which is a more detailed list than Charlson. “AHRQ37” is an adapation of the AHRQ version 37 software<span class="citation">(Agency for Healthcare Research &amp; Quality 2013)</span>.<br />“Quan” refers to the same paper by Quan mentioned above.</p>
<p>“RCRI” is the Revised Cardiac Risk Index<span class="citation">(Lee et al. 1999)</span> set of categories using a method published by Boersma<span class="citation">(Boersma et al. 2005)</span>.</p>
<p>For example, the #5 ICD-9-CM code above is D25000, or “250.00”, which is for “Diabetes Mellitus Unspecified Type”. Here’s what happens when that code is passed to a few of the mapping functions listed above:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(
  <span class="kw">icd9cm_charlson_quan</span>(<span class="kw">c</span>(<span class="st">'D25000'</span>)))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">mi</th>
<th align="left">chf</th>
<th align="left">perivasc</th>
<th align="left">cvd</th>
<th align="left">dementia</th>
<th align="left">chrnlung</th>
<th align="left">rheum</th>
<th align="left">ulcer</th>
<th align="left">liver</th>
<th align="left">dm</th>
<th align="left">dmcx</th>
<th align="left">para</th>
<th align="left">renal</th>
<th align="left">tumor</th>
<th align="left">modliver</th>
<th align="left">mets</th>
<th align="left">aids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">D25000</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(
  <span class="kw">icd9cm_elixhauser_ahrq37</span>(<span class="kw">c</span>(<span class="st">'D25000'</span>)))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">chf</th>
<th align="left">arrhythmia</th>
<th align="left">valve</th>
<th align="left">pulmcirc</th>
<th align="left">perivasc</th>
<th align="left">htn</th>
<th align="left">htncx</th>
<th align="left">para</th>
<th align="left">neuro</th>
<th align="left">chrnlung</th>
<th align="left">dm</th>
<th align="left">dmcx</th>
<th align="left">hypothy</th>
<th align="left">renlfail</th>
<th align="left">liver</th>
<th align="left">ulcer</th>
<th align="left">aids</th>
<th align="left">lymph</th>
<th align="left">mets</th>
<th align="left">tumor</th>
<th align="left">rheum</th>
<th align="left">coag</th>
<th align="left">obese</th>
<th align="left">wghtloss</th>
<th align="left">lytes</th>
<th align="left">bldloss</th>
<th align="left">anemdef</th>
<th align="left">alcohol</th>
<th align="left">drug</th>
<th align="left">psych</th>
<th align="left">depress</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">D25000</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(
  <span class="kw">icd9cm_rcri</span>(<span class="kw">c</span>(<span class="st">'D25000'</span>)))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">chf</th>
<th align="left">cvd</th>
<th align="left">dm</th>
<th align="left">ischemia</th>
<th align="left">renlfail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">D25000</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>For each of these maps the “dm” column becomes TRUE.</p>
<p>The most efficient way to use these maps for a set of patients is to generate a single map for all ICD-9-CM codes in the set and then apply that map to each patient. Here’s an example that generates a comorbidity matrix for the first five patients in the Vermont dataset:</p>
<pre class="sourceCode r"><code class="sourceCode r">cases &lt;-<span class="st"> </span>vt_inp_sample[vt_inp_sample$id %in%<span class="st"> </span><span class="dv">1</span>:<span class="dv">5</span>, <span class="kw">c</span>(<span class="st">'id'</span>,<span class="st">'icd9cm'</span>)]
cases_with_cm &lt;-<span class="st"> </span><span class="kw">merge</span>(cases, <span class="kw">icd9cm_charlson_quan</span>(<span class="kw">levels</span>(cases$icd9cm)), 
   <span class="dt">by.x=</span><span class="st">&quot;icd9cm&quot;</span>, <span class="dt">by.y=</span><span class="st">&quot;row.names&quot;</span>, <span class="dt">all.x=</span><span class="ot">TRUE</span>)
 
<span class="co"># generate crude comorbidity summary for each patient</span>
<span class="kw">kable</span>(
  <span class="kw">ddply</span>(cases_with_cm, .(id), 
   function(x) { <span class="kw">data.frame</span>(<span class="kw">lapply</span>(x[,<span class="dv">3</span>:<span class="kw">ncol</span>(x)], any)) }),
  <span class="dt">row.names=</span>F)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="left">mi</th>
<th align="left">chf</th>
<th align="left">perivasc</th>
<th align="left">cvd</th>
<th align="left">dementia</th>
<th align="left">chrnlung</th>
<th align="left">rheum</th>
<th align="left">ulcer</th>
<th align="left">liver</th>
<th align="left">dm</th>
<th align="left">dmcx</th>
<th align="left">para</th>
<th align="left">renal</th>
<th align="left">tumor</th>
<th align="left">modliver</th>
<th align="left">mets</th>
<th align="left">aids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>The above process is encapsulated in a single function <code>generate_comorbidity_df</code>. This function also includes an optimization from Van Walraven that reduces <code>dmcx</code> to <code>dm</code> if the specific diabetic complication is separately coded.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(
  <span class="kw">generate_comorbidity_df</span>(cases, <span class="dt">icd9mapfn=</span>icd9cm_charlson_quan))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="left">mi</th>
<th align="left">chf</th>
<th align="left">perivasc</th>
<th align="left">cvd</th>
<th align="left">dementia</th>
<th align="left">chrnlung</th>
<th align="left">rheum</th>
<th align="left">ulcer</th>
<th align="left">liver</th>
<th align="left">dm</th>
<th align="left">dmcx</th>
<th align="left">para</th>
<th align="left">renal</th>
<th align="left">tumor</th>
<th align="left">modliver</th>
<th align="left">mets</th>
<th align="left">aids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>This function only considers each ICD-9-CM code once and then merges the resulting comorbidity flags together for each patient. This makes the function quite fast for large data sets.</p>
<p>Given appropriate arguments, the <code>generate_comorbidity_df</code> function will use the parallel backend provided by <code>foreach</code> to improve performance.</p>
</div>
<div id="comorbidity-index" class="section level2">
<h2>Comorbidity Index</h2>
<p>It is common in the medical literature to see a set of comorbidities reduced to an index. When the Charlson Comorbidity Index was first published it had the following weights for each comorbidity:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(charlson_weights_orig)
<span class="kw">kable</span>(
  <span class="kw">t</span>(charlson_weights_orig))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">mi</th>
<th align="left">chf</th>
<th align="left">perivasc</th>
<th align="left">cvd</th>
<th align="left">dementia</th>
<th align="left">chrnlung</th>
<th align="left">rheum</th>
<th align="left">ulcer</th>
<th align="left">liver</th>
<th align="left">dm</th>
<th align="left">dmcx</th>
<th align="left">para</th>
<th align="left">renal</th>
<th align="left">tumor</th>
<th align="left">modliver</th>
<th align="left">mets</th>
<th align="left">aids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">3</td>
<td align="left">6</td>
<td align="left">6</td>
</tr>
</tbody>
</table>
<p>However, these weights have not stood the test of time. For example, the prognosis for HIV/AIDS has dramatically improved.<br />The medicalrisk package offers the revised Charlson weights developed by Schneeweiss<span class="citation">(Schneeweiss et al. 2003)</span>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(charlson_weights)
<span class="kw">kable</span>(
  <span class="kw">t</span>(charlson_weights))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">mi</th>
<th align="left">chf</th>
<th align="left">perivasc</th>
<th align="left">cvd</th>
<th align="left">dementia</th>
<th align="left">chrnlung</th>
<th align="left">rheum</th>
<th align="left">ulcer</th>
<th align="left">liver</th>
<th align="left">dm</th>
<th align="left">dmcx</th>
<th align="left">para</th>
<th align="left">renal</th>
<th align="left">tumor</th>
<th align="left">modliver</th>
<th align="left">mets</th>
<th align="left">aids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">2</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">2</td>
<td align="left">4</td>
<td align="left">6</td>
<td align="left">4</td>
</tr>
</tbody>
</table>
<p>The <code>generate_charlson_index_df</code> function will sum the weights for each patient to generate a final index:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(
  <span class="kw">generate_charlson_index_df</span>(<span class="kw">generate_comorbidity_df</span>(cases)), <span class="dt">row.names=</span>F)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div id="risk-stratification-index" class="section level2">
<h2>Risk Stratification Index</h2>
<p>The Risk Stratification Index uses ICD-9-CM codes to determine four risk estimates:</p>
<ul>
<li>1 Year Mortality</li>
<li>30 Day Mortality</li>
<li>In-Hospital Mortality</li>
<li>30 Day Length of Stay</li>
</ul>
<p>The author of the paper (Sessler) published SPSS code to perform the calculation. The medicalrisk implements the RSi calculation using a method based on the SPSS code.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ddply</span>(cases, .(id), function(x) { <span class="kw">icd9cm_sessler_rsi</span>(x$icd9cm) } )</code></pre>
<pre><code>##   id rsi_1yrpod rsi_30dlos rsi_30dpod rsi_inhosp
## 1  1 -2.0186043  0.1560323  -1.699242 -1.8483037
## 2  2 -4.1423990  0.8927947  -3.802495 -3.5425015
## 3  3 -2.6265277  0.8311247  -2.910939 -2.8607594
## 4  4 -0.7984382  0.3357922  -1.551285 -0.2669842
## 5  5  2.5803930 -1.7904270   2.455086  1.7615180</code></pre>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>The medicalrisk package can be used to generate risk data from ICD-9-CM codes in large datasets. The above discussion describes basic use of the package. There are some additional helper functions not described above which are included in the per function documentation.</p>
<p>The aim of this package is to include future medical risk estimation procedures as they are published in the literature.</p>
<div class="references">
<h2>References</h2>
<p>Agency for Healthcare Research &amp; Quality. 2013. “HCUP Comorbidity Software. Healthcare Cost and Utilization Project (HCUP). [Version 3.7].” <a href="http://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp" class="uri">http://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp</a>.</p>
<p>Boersma, Eric, Miklos D Kertai, Olaf Schouten, Jeroen J Bax, Peter Noordzij, Ewout W Steyerberg, Arend F L Schinkel, et al. 2005. “Perioperative cardiovascular mortality in noncardiac surgery: validation of the Lee cardiac risk index.” <em>The American Journal of Medicine</em> 118 (10): 1134–41. doi:<a href="http://dx.doi.org/10.1016/j.amjmed.2005.01.064">10.1016/j.amjmed.2005.01.064</a>.</p>
<p>Charlson, M E, P Pompei, K L Ales, and C R MacKenzie. 1987. “A new method of classifying prognostic comorbidity in longitudinal studies: development and validation.” <em>Journal of Chronic Diseases</em> 40 (5): 373–83. <a href="http://www.ncbi.nlm.nih.gov/pubmed/3558716" class="uri">http://www.ncbi.nlm.nih.gov/pubmed/3558716</a>.</p>
<p>Deyo, R A, D C Cherkin, and M A Ciol. 1992. “Adapting a clinical comorbidity index for use with ICD-9-CM administrative databases.” <em>Journal of Clinical Epidemiology</em> 45 (6): 613–9. <a href="http://www.ncbi.nlm.nih.gov/pubmed/1607900" class="uri">http://www.ncbi.nlm.nih.gov/pubmed/1607900</a>.</p>
<p>Lee, T H, E R Marcantonio, C M Mangione, E J Thomas, C A Polanczyk, E F Cook, D J Sugarbaker, et al. 1999. “Derivation and prospective validation of a simple index for prediction of cardiac risk of major noncardiac surgery.” <em>Circulation</em> 100 (10): 1043–9. <a href="http://www.ncbi.nlm.nih.gov/pubmed/10477528" class="uri">http://www.ncbi.nlm.nih.gov/pubmed/10477528</a>.</p>
<p>McCormick, Patrick, and Thomas Joseph. 2015. <em>Medicalrisk: Medical Risk and Comorbidity Tools for ICD-9-CM Data</em>.</p>
<p>Quan, Hude, Vijaya Sundararajan, Patricia Halfon, Andrew Fong, Bernard Burnand, Jean-Christophe Luthi, L Duncan Saunders, Cynthia A Beck, Thomas E Feasby, and William A Ghali. 2005. “Coding algorithms for defining comorbidities in ICD-9-CM and ICD-10 administrative data.” <em>Medical Care</em> 43 (11): 1130–9. <a href="http://www.ncbi.nlm.nih.gov/pubmed/16224307" class="uri">http://www.ncbi.nlm.nih.gov/pubmed/16224307</a>.</p>
<p>Romano, P S, L L Roos, and J G Jollis. 1993. “Adapting a clinical comorbidity index for use with ICD-9-CM administrative data: differing perspectives.” <em>Journal of Clinical Epidemiology</em> 46 (10): 1075–9; discussion 1081–90. <a href="http://www.ncbi.nlm.nih.gov/pubmed/8410092" class="uri">http://www.ncbi.nlm.nih.gov/pubmed/8410092</a>.</p>
<p>Schneeweiss, Sebastian, Philip S Wang, Jerry Avorn, and Robert J Glynn. 2003. “Improved comorbidity adjustment for predicting mortality in Medicare populations.” <em>Health Services Research</em> 38 (4): 1103–20. <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC1360935/" class="uri">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC1360935/</a>.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
